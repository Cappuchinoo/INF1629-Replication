db,llm,prompt_technique,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,mistral-small-latest,chain-of-thought,1,2411.255,178.496,0.138,41037,1950.746,185.666,0.130,38037,2.8525587387635163e-05,2.437221948383913e-05,1.236,True,True,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT c.id AS customer_id, c.firstname || ' ' || c.lastname AS full_name,        (SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id           AND date_trunc('year', o.ordertimestamp) = (               SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""           )) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL ORDER BY (SELECT SUM(o2.total::numeric) FROM ""order"" o2 WHERE o2.customer = c.id) DESC"
webshopdb,mistral-small-latest,chain-of-thought,2,2530.857,13.984,0.477,464,NaN,NaN,NaN,,2.9968117078503378e-05,nan,NaN,False,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN order o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM order)   AND p.name IS NOT NULL ORDER BY rnd"
webshopdb,mistral-small-latest,chain-of-thought,3,1904.377,3.347,0.194,82,1719.430,3.331,0.190,82,2.2491472678780403e-05,2.0257982540718375e-05,1.108,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT c.id, c.firstname, c.lastname, c.email FROM customer c JOIN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) o_filtered ON c.id = o_filtered.customer"
webshopdb,mistral-small-latest,chain-of-thought,4,2050.105,2.085,0.196,56,2016.989,2.094,0.222,56,2.41686538784453e-05,2.3791250628474852e-05,1.016,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" WHERE customer IS NOT NULL) ORDER BY o.ordertimestamp DESC"
webshopdb,mistral-small-latest,chain-of-thought,5,1809.850,77.334,0.186,16529,1723.742,3.523,0.232,56,2.131542668687718e-05,2.0362995820701764e-05,1.050,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT c.id, c.firstname, c.lastname, COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE EXISTS (SELECT 1 FROM ""order"" o2 WHERE o2.customer = c.id) GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC NULLS LAST"
webshopdb,mistral-small-latest,chain-of-thought,6,1419.815,12.018,0.382,463,NaN,NaN,NaN,,1.6635043618447246e-05,nan,NaN,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT p.id AS product_id, p.name AS product_name, SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE   AND o.deleted = FALSE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10"
webshopdb,mistral-small-latest,chain-of-thought,7,1570.781,1.284,0.194,37,1557.735,1.310,0.199,37,1.850620391359311e-05,1.834644886038698e-05,1.008,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT c.id, c.firstname, c.lastname, COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50"
webshopdb,mistral-small-latest,chain-of-thought,8,1721.749,1.740,0.203,56,1720.024,1.724,0.207,56,2.0246046031169493e-05,2.0206974853291982e-05,1.001,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT o.id AS order_id, o.ordertimestamp, c.id AS customer_id, c.firstname, c.lastname, o.total, o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500"
webshopdb,mistral-small-latest,chain-of-thought,9,1715.525,9.562,0.326,463,1703.835,9.726,0.347,463,2.0194828386274907e-05,2.0058602082581545e-05,1.007,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT p.category, p.id AS product_id, p.name AS product_name, SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,mistral-small-latest,chain-of-thought,10,1565.852,1.906,0.244,37,1577.454,1.900,0.184,37,1.841929886848148e-05,1.8572637784151143e-05,0.993,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT c.id, c.firstname, c.lastname, MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp < current_date - interval '6 months' OR o.ordertimestamp IS NULL GROUP BY c.id, c.firstname, c.lastname ORDER BY last_order_timestamp NULLS FIRST LIMIT 200"
webshopdb,mistral-small-latest,chain-of-thought,11,1406.219,2.217,0.185,37,1414.044,3.482,0.295,56,1.653243528242539e-05,1.6634090380672276e-05,0.994,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT c.id, c.firstname, c.lastname, COUNT(o.id) AS num_orders, SUM(o.total::numeric) AS total_spent, AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id WHERE EXISTS (SELECT 1 FROM ""order"" o2 WHERE o2.customer = c.id LIMIT 3) GROUP BY c.id, c.firstname, c.lastname ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,mistral-small-latest,chain-of-thought,12,1426.210,23.052,0.333,538,1407.841,19.988,0.315,538,1.6880550567053402e-05,1.6594456287660945e-05,1.013,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT p.id AS product_id, p.name AS product_name, COALESCE(SUM(s.count), 0) AS total_stock, COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN LATERAL (     SELECT count FROM stock WHERE articleid = a.id ) s ON true LEFT JOIN LATERAL (     SELECT amount FROM order_positions WHERE articleid = a.id ) op ON true GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,mistral-small-latest,chain-of-thought,13,1584.492,13.212,0.283,444,1586.285,14.174,0.282,444,1.8624387521052218e-05,1.8664528356707357e-05,0.999,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,mistral-small-latest,chain-of-thought,14,1744.648,14.396,0.370,462,2166.546,547.242,0.492,137091,2.0501861965299947e-05,2.549333398038746e-05,0.805,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE EXISTS (     SELECT 1     FROM order_positions op2     JOIN articles a2 ON a2.id = op2.articleid     JOIN products p2 ON p2.id = a2.productid     WHERE op2.orderid = o.id     GROUP BY p2.category     HAVING COUNT(*) >= 3 ) GROUP BY c.id, c.firstname, c.lastname ORDER BY categories_bought DESC, c.id;"
webshopdb,mistral-small-latest,chain-of-thought,15,1718.336,12.222,0.443,576,1713.718,12.376,0.436,576,2.0190338573147652e-05,2.017935239026783e-05,1.003,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT a.id AS article_id, a.description, p.name AS product_name, COALESCE(SUM(s.count), 0) AS current_stock, COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MAX(ordertimestamp) FROM ""order"") - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
