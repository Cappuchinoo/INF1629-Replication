db,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,buffers_ratio,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,1,1824.888,10.665,0.187,10828,1772.283,3.116,0.258,41,3.423,264.098,2.1674885672860405e-05,2.1377491746584708e-05,True,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT     c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     COALESCE(SUM(CASE WHEN date_trunc('year', o.ordertimestamp) = (         SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""     ) THEN o.total::numeric ELSE 0 END), 0) AS total_spent_last_year FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE c.email IS NOT NULL GROUP BY c.id, c.firstname, c.lastname ORDER BY SUM(o.total::numeric) DESC;"
webshopdb,2,2218.068,12.720,0.475,449,nan,,,,,,2.6314139578462038e-05,nan,False,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","To optimize this SQL query for lower latency in PostgreSQL, we can follow these steps:  1. **Remove Unnecessary Subqueries**: The subquery in the WHERE clause is redundant and can be simplified. Since the query is comparing `o.ordertimestamp` to the MIN value in the same table and column, it effectively filters nothing. Hence, remove the subquery.  2. **Index Usage**: Ensure there are appropriate indexes on columns used in JOINs and WHERE conditions, particularly `order.id`, `order_positions.orderid`, and `article.productid`.  3. **Avoid Using DISTINCT Unless Necessary**: If there are no duplicate combinations due to the JOIN conditions, DISTINCT can be unnecessary, but it depends on the data. For now, we'll presume it's necessary.  4. **Ordering**: Random ordering inhibits optimization due to its non-deterministic nature. However, assuming the random order is needed, little can be done with this part other than ensuring the use of random ordering is genuinely required.  5. **Simplify and Remove Filters That Don’t Change Result**: The filter `p.name IS NOT NULL` suggests that there are no null names expected, but if enforced"
webshopdb,3,1764.807,3.361,0.213,82,2283.605,3.567,0.254,82,0.942,1.000,2.092764935931923e-05,2.7100550776886628e-05,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c JOIN ""order"" o ON c.id = o.customer JOIN order_positions op ON op.orderid = o.id WHERE op.amount >= 1"
webshopdb,4,2121.275,1.838,0.248,41,2056.520,1.538,0.176,37,1.195,1.108,2.5606716688547096e-05,2.439724401504358e-05,False,False,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM     customer c LEFT JOIN     ""order"" o ON o.customer = c.id ORDER BY     o.ordertimestamp DESC;"
webshopdb,5,1771.214,4.978,0.229,3676,1755.909,3.407,0.296,56,1.461,65.643,2.1032235068462574e-05,2.12939567772472e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT     c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE EXISTS (SELECT 1 FROM ""order"" WHERE customer = c.id) GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC"
webshopdb,6,1439.962,11.690,0.505,448,1442.851,12.235,0.446,444,0.955,1.009,1.7035166513727627e-05,1.6960652104111354e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10"
webshopdb,7,1618.040,1.295,0.221,37,1612.447,0.827,0.157,37,1.566,1.000,1.904755611107285e-05,1.899872512829941e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT     c.id,     c.firstname,     c.lastname,     filtered_orders.num_orders FROM     customer c JOIN (     SELECT         o.customer,         COUNT(o.id) AS num_orders     FROM         ""order"" o     GROUP BY         o.customer     HAVING         COUNT(o.id) >= 5 ) AS filtered_orders ON filtered_orders.customer = c.id ORDER BY     filtered_orders.num_orders DESC LIMIT 50"
webshopdb,8,1769.979,1.479,0.255,41,1767.851,1.260,0.198,1687,1.174,0.024,2.0835477978796126e-05,2.0868710179919356e-05,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer ORDER BY o.ordertimestamp DESC LIMIT 500"
webshopdb,9,1752.290,9.156,0.410,448,1738.176,10.170,0.398,444,0.900,1.009,2.0712543509845905e-05,2.0579074565545894e-05,True,False,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,10,1634.387,1.789,0.229,37,1641.884,1.497,0.151,37,1.195,1.000,1.930364160044244e-05,1.9313835531128513e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT     c.id,     c.firstname,     c.lastname,     last_order_timestamp FROM customer c LEFT JOIN (     SELECT         customer,         MAX(ordertimestamp) AS last_order_timestamp     FROM ""order""     GROUP BY customer ) o ON o.customer = c.id WHERE (last_order_timestamp < current_date - interval '6 months' OR last_order_timestamp IS NULL) ORDER BY last_order_timestamp NULLS FIRST LIMIT 200"
webshopdb,11,1437.669,2.233,0.296,37,1431.546,1.989,0.134,37,1.123,1.000,1.6896902321989844e-05,1.7139817498662995e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","WITH CustomerOrderSummary AS (     SELECT         o.customer AS customer_id,         COUNT(o.id) AS num_orders,         SUM(o.total::numeric) AS total_spent,         AVG(o.total::numeric) AS avg_order_value     FROM ""order"" o     GROUP BY o.customer     HAVING COUNT(o.id) >= 3 ) SELECT     c.id,     c.firstname,     c.lastname,     cos.num_orders,     cos.total_spent,     cos.avg_order_value FROM customer c JOIN CustomerOrderSummary cos ON c.id = cos.customer_id ORDER BY cos.avg_order_value DESC LIMIT 20;"
webshopdb,12,1451.916,20.112,0.446,538,nan,,,,,,1.7694473615341675e-05,nan,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(stock_data.total_stock, 0) AS total_stock,     COALESCE(sales_data.total_sold, 0) AS total_sold FROM      products p JOIN articles a ON a.productid = p.id LEFT JOIN (     SELECT s.articleid, SUM(s.count) AS total_stock     FROM stock s     GROUP BY s.articleid ) stock_data ON stock_data.articleid = a.id LEFT JOIN (     SELECT op.articleid, SUM(op.amount) AS total_sold     FROM order_positions op     GROUP BY op.articleid ) sales_data ON sales_data.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(stock_data.total_stock, 0) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,13,1615.551,13.876,0.357,444,1622.063,11.638,0.369,444,1.192,1.000,1.913133841648819e-05,1.9232675488597127e-05,True,False,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY date_trunc('month', o.ordertimestamp), p.category ORDER BY month, revenue DESC;"
webshopdb,14,1770.802,13.593,0.483,462,1750.644,12.248,0.438,462,1.110,1.000,2.1074926383742542e-05,2.0851298382650653e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","WITH pre_aggregated AS (     SELECT         o.customer AS customer_id,         COUNT(DISTINCT p.category) AS categories_bought     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     JOIN articles a ON a.id = op.articleid     JOIN products p ON p.id = a.productid     GROUP BY o.customer ) SELECT     c.id,     c.firstname,     c.lastname,     pa.categories_bought FROM customer c JOIN pre_aggregated pa ON pa.customer_id = c.id WHERE pa.categories_bought >= 3 ORDER BY pa.categories_bought DESC, c.id;"
webshopdb,15,1768.450,12.353,0.667,566,1755.260,11.907,0.660,566,1.037,1.000,2.0999633811542373e-05,2.0826771478088932e-05,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MAX(ordertimestamp) FROM ""order"") - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,16,1605.993,7.268,0.222,425,1614.578,7.077,0.268,425,1.027,1.000,1.9500473093080203e-05,1.9392727104880343e-05,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT     p.id,     p.name FROM products p LEFT JOIN (     SELECT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id ) sub ON p.id = sub.productid WHERE sub.productid IS NULL;"
webshopdb,17,1935.488,388.403,0.377,128697,nan,,,,,,2.2996922444525215e-05,nan,False,False,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT     p.id,     p.name,     p.category,     a.reducedprice,     avg_category_price FROM (     SELECT         a.productid,         a.reducedprice,         AVG(a.reducedprice::numeric) OVER (PARTITION BY p.category) AS avg_category_price     FROM articles a     JOIN products p ON a.productid = p.id ) AS subquery JOIN products p ON p.id = subquery.productid WHERE subquery.reducedprice::numeric > subquery.avg_category_price LIMIT 50;"
webshopdb,18,1802.882,4.201,0.112,3921,1625.600,1.943,0.144,37,2.162,105.973,2.1400216486422e-05,1.928034438721637e-05,True,True,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","WITH total_spent AS (     SELECT          o.customer AS customer_id,          SUM(o.total::numeric) AS total_sum     FROM          ""order"" o     GROUP BY          o.customer ) SELECT      c.id,      c.firstname,      c.lastname FROM      customer c LEFT JOIN      total_spent ts ON c.id = ts.customer_id ORDER BY      ts.total_sum DESC LIMIT 50;"
webshopdb,19,1843.659,1.860,0.103,2713,1844.888,1.342,0.178,37,1.386,73.324,2.1932247754675485e-05,2.1869591108859194e-05,True,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT      c.id,     c.firstname,     COUNT(o.id) AS total_orders FROM      customer c LEFT JOIN      ""order"" o ON o.customer = c.id WHERE      c.id < 1000 GROUP BY      c.id;"
webshopdb,20,1681.897,0.925,0.066,19,nan,,,,,,2.000631125617209e-05,nan,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total > 50;"
webshopdb,21,1834.768,15.084,0.335,493,1810.935,12.705,0.234,493,1.187,1.000,2.1984404561283547e-05,2.1460918103044268e-05,True,False,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(s.total_stock, 0) AS total_stock FROM products p LEFT JOIN (     SELECT a.productid, SUM(s.count) AS total_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     GROUP BY a.productid ) s ON s.productid = p.id ORDER BY total_stock DESC;"
webshopdb,22,1600.014,0.029,0.086,1,1492.774,0.029,0.087,1,1.000,1.000,1.9023618370400408e-05,1.774320048081475e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;","SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;"
webshopdb,23,1494.627,8.945,0.320,425,1597.109,8.505,0.326,425,1.052,1.000,1.7770968594393647e-05,1.920318365630229e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;"
webshopdb,24,1515.847,0.066,0.512,4,1519.902,0.070,0.553,4,0.943,1.000,1.807696491528251e-05,1.819592111194354e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;"
webshopdb,25,1618.951,17.644,0.356,520,1506.181,15.678,0.327,520,1.125,1.000,1.9596543004810702e-05,1.8463886014515722e-05,True,True,"WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     (total_sold * 1.0 / NULLIF(current_stock, 0)) AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;","SELECT     a.id AS article_id,     a.description,     SUM(op.amount) AS total_sold,     COALESCE(SUM(s.count), 0) AS current_stock,     (SUM(op.amount) * 1.0 / NULLIF(COALESCE(SUM(s.count), 0), 0)) AS demand_index FROM articles a LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id GROUP BY a.id, a.description ORDER BY demand_index DESC NULLS LAST LIMIT 10;"
