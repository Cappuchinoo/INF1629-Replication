db,llm,prompt_technique,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,llama3.1:8b,zero-shot,1,2552.457,221.899,0.172,41037,2465.103,186.154,0.140,38037,8.281240852062445e-07,1.1987859729554455e-06,1.035,True,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT      c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     COALESCE(         (             SELECT SUM(o.total::numeric)             FROM ""order"" o             WHERE o.customer = c.id               AND date_trunc('year', o.ordertimestamp) =                  (SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order"")         ),         0     ) AS total_spent_last_year FROM customer c WHERE email IS NOT NULL ORDER BY COALESCE(     (         SELECT SUM(o2.total::numeric)         FROM ""order"" o2         WHERE o2.customer = c.id     ),     0 ) DESC;"
webshopdb,llama3.1:8b,zero-shot,2,3078.297,14.018,0.411,464,2986.762,13.458,0.412,464,1.2441548061900592e-06,1.00541008766338e-06,1.031,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT      a.id AS article_id,      p.name AS product_name,      a.originalprice,      a.reducedprice,      c.name AS color_name,     (random() * 1000000) :: integer AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL ORDER BY rnd;"
webshopdb,llama3.1:8b,zero-shot,3,2198.216,3.355,0.199,82,NaN,NaN,NaN,,1.0924277041971516e-06,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT      c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) ```  However, to optimize this query for PostgreSQL and decrease latency, we can use the following equivalent query:  ```sql SELECT      c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id = ANY (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) ```  This query uses the `ANY` operator instead of `IN`, which can be more efficient when dealing with large result sets."
webshopdb,llama3.1:8b,zero-shot,4,2680.398,2.153,0.216,56,2773.659,2.052,0.199,56,8.806626914527844e-07,9.192984252892234e-07,0.966,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT      c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC;"
webshopdb,llama3.1:8b,zero-shot,5,2360.244,79.645,0.195,16529,2260.408,2.367,0.162,37,1.1566512966996808e-06,1.1164131186146293e-06,1.044,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT      c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c JOIN ""order"" o ON c.id = o.customer GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC NULLS LAST;"
webshopdb,llama3.1:8b,zero-shot,6,1812.161,11.731,0.410,463,1811.988,12.706,0.431,463,7.331765090646205e-07,7.329119466838783e-07,1.000,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;"
webshopdb,llama3.1:8b,zero-shot,7,1954.147,1.361,0.188,37,NaN,NaN,NaN,,7.908491943527305e-07,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(*) >= 5 ORDER BY count DESC LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,8,2362.635,1.727,0.210,56,2365.268,1.742,0.204,56,1.0438978885519822e-06,1.045481192217232e-06,0.999,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT      o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500;"
webshopdb,llama3.1:8b,zero-shot,9,2463.312,9.487,0.332,463,2463.560,9.560,0.338,463,1.1973295437057833e-06,1.0730179479445503e-06,1.000,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;"
webshopdb,llama3.1:8b,zero-shot,10,2023.406,1.732,0.192,37,1910.668,1.880,0.198,37,9.522008658746007e-07,7.727222129873309e-07,1.059,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT      c.id,     c.firstname,     c.lastname,     o.ordertimestamp AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE (     (o.ordertimestamp < current_date - interval '6 months')     OR o.ordertimestamp IS NULL ) GROUP BY      c.id,      c.firstname,      c.lastname,      o.ordertimestamp HAVING COUNT(*) > 1 ORDER BY last_order_timestamp NULLS FIRST LIMIT 200;"
webshopdb,llama3.1:8b,zero-shot,11,1957.265,2.622,0.188,37,NaN,NaN,NaN,,7.914188686447615e-07,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer_id = c.id  -- Corrected column name GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,llama3.1:8b,zero-shot,12,1850.683,21.694,0.345,538,1750.336,21.745,0.337,538,7.484597993701487e-07,7.079526890231982e-07,1.057,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) AS total_stock,     COALESCE(SUM(CASE WHEN op.amount IS NOT NULL THEN op.amount ELSE 0 END), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,llama3.1:8b,zero-shot,13,2052.628,13.868,0.279,444,2055.897,14.357,0.311,444,9.60093737129915e-07,1.0337440919300514e-06,0.998,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT      date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,llama3.1:8b,zero-shot,14,2150.461,14.390,0.371,462,2248.522,14.322,0.376,462,9.86735488130561e-07,1.1115917596416367e-06,0.956,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY COUNT(DISTINCT p.category) DESC, c.id;"
webshopdb,llama3.1:8b,zero-shot,15,2258.142,12.093,0.460,576,1848.892,0.388,0.428,21,1.0170188484643608e-06,7.487808534896881e-07,1.221,False,False,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT      a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= NOW() - INTERVAL '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,llama3.1:8b,zero-shot,16,2568.183,9.365,0.239,425,NaN,NaN,NaN,,8.354699884673699e-07,nan,NaN,False,False,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT      p.id,     p.name FROM products p LEFT JOIN articles a ON p.id = a.productid LEFT JOIN (     SELECT articleid, productid FROM order_positions ) op ON a.id = op.articleid WHERE a.productid IS NULL;"
webshopdb,llama3.1:8b,zero-shot,17,2462.889,652.758,0.290,57022,NaN,NaN,NaN,,1.1979083959321007e-06,nan,NaN,False,False,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT      p.id,     p.name,     p.category,     a.reducedprice,     avg_category_price FROM (     SELECT DISTINCT on (p.category)          p.id,          p.name,          p.category,          a.reducedprice,         AVG(a2.reducedprice::numeric) OVER (PARTITION BY p.category) AS avg_category_price     FROM products p     JOIN articles a ON a.productid = p.id     JOIN articles a2 ON a2.productid = p.id ) subquery JOIN LATERAL (     SELECT AVG(reducedprice::numeric) AS threshold     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = subquery.category ) threshold ON TRUE WHERE reducedprice > threshold.threshold LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,18,2259.833,85.906,0.124,19018,2111.028,2.389,0.191,37,1.0159901463313251e-06,1.0568775032248534e-06,1.070,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      id,      firstname,      lastname FROM (     SELECT          c.id,          c.firstname,          c.lastname,         SUM(o.total::numeric) AS total_spent     FROM customer c     LEFT JOIN ""order"" o ON o.customer = c.id     GROUP BY c.id, c.firstname, c.lastname ) AS subquery ORDER BY total_spent DESC LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,19,2361.887,77.424,0.100,17080,NaN,NaN,NaN,,1.044494001008799e-06,nan,NaN,False,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","EXPLAIN ANALYZE SELECT      c.id,     c.firstname,     coalesce((SELECT count(*) FROM ""order"" o WHERE o.customer = c.id), 0) AS total_orders FROM customer c WHERE c.id < 1000; ```  Note: This query uses `COALESCE` to avoid a subquery that returns no rows (which can be slow in PostgreSQL). The `EXPLAIN ANALYZE` statement is used to analyze the performance of the query."
webshopdb,llama3.1:8b,zero-shot,20,1952.798,0.890,0.060,19,2159.995,0.938,0.062,19,7.895037865629786e-07,9.894860935880294e-07,0.904,True,True,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      id,     ordertimestamp,     total FROM ""order"" WHERE EXTRACT(MONTH FROM ordertimestamp) = 12   AND total::numeric > 50;"
webshopdb,1,1925.029,12.295,0.178,10828,nan,,,,,,2.3420126675147263e-05,nan,False,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT      c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     COALESCE(         (           SELECT SUM(o.total::numeric)           FROM ""order"" o           JOIN LATERAL (SELECT MIN(ordertimestamp) AS ordertimestamp) AS s ON 1=1           WHERE o.customer = c.id             AND date_trunc('year', o.ordertimestamp) = date_trunc('year', s.ordertimestamp)         ),          0     ) AS total_spent_last_year FROM customer c WHERE email IS NOT NULL ORDER BY      COALESCE(         (           SELECT SUM(o2.total::numeric)           FROM ""order"" o2           JOIN LATERAL (SELECT MIN(ordertimestamp) AS ordertimestamp) AS s ON 1=1           WHERE o2.customer = c.id             AND date_trunc('year', o2.ordertimestamp) = date_trunc('year', s.ordertimestamp)         ),          0     ) DESC"
webshopdb,2,2844.689,12.589,0.478,449,nan,,,,,,3.443365661106762e-05,nan,False,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT      a.id AS article_id,      p.name AS product_name,      a.originalprice,      a.reducedprice,      c.name AS color_name,     random() OVER () AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL ORDER BY rnd;"
webshopdb,3,1967.696,3.342,0.212,82,1989.904,3.309,0.195,82,1.010,1.000,2.4467083002321563e-05,2.378055568533968e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT      c.id,      c.firstname,      c.lastname,      c.email FROM customer c JOIN (     SELECT DISTINCT o.customer AS customer_id     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) sub ON sub.customer_id = c.id"
webshopdb,4,1995.893,1.979,0.353,41,1571.784,0.264,0.205,22,7.496,1.864,2.392395048211783e-05,1.8577357020559128e-05,False,False,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT      c.id,      c.firstname,      c.lastname,      o.id AS order_id,      o.ordertimestamp FROM customer c LEFT JOIN (     SELECT id,            ordertimestamp,            ROW_NUMBER() OVER (ORDER BY ordertimestamp DESC) AS row_num     FROM ""order"" ) o ON o.id = c.id AND o.row_num = 1 WHERE o.row_num IS NOT NULL"
webshopdb,5,1968.991,4.948,0.233,3676,1846.756,5.031,0.163,3676,0.984,1.000,2.367359433389861e-05,2.242009240200114e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT      c.id,      c.firstname,      c.lastname,      (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c JOIN (SELECT DISTINCT customer FROM ""order"") sub ON sub.customer = c.id ORDER BY (  SELECT SUM(o.total::numeric)              FROM ""order"" o             WHERE o.customer = c.id  ) DESC NULLS LAST"
webshopdb,6,1658.927,11.924,0.512,448,nan,,,,,,2.0089781643513858e-05,nan,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;  Rewritten SQL:  SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE (o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order""))    AND ((p.currentlyactive) OR (EXISTS (         SELECT 1 FROM ""order"" WHERE ordertimestamp < (SELECT MIN(ordertimestamp) FROM ""order"")     ) AND p.id IN (         SELECT o.orderid         FROM order_positions op         JOIN ""order"" o ON op.orderid = o.id         WHERE op.articleid IN (             SELECT a.id             FROM articles a             JOIN products p ON a.productid = p.id             WHERE p.currentlyactive = TRUE         )     ))) GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;"
webshopdb,7,1795.079,1.440,0.246,37,1767.027,1.311,0.219,37,1.098,1.000,2.1713787276266507e-05,2.0985280258681964e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(*) >= 5 ORDER BY num_orders DESC LIMIT 50;"
webshopdb,8,1931.094,1.567,0.253,41,1992.045,1.501,0.255,41,1.044,1.000,2.3472442923846927e-05,2.389297311086935e-05,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT      o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (     SELECT MIN(o2.ordertimestamp)     FROM ""order"" o2 )  ORDER BY o.ordertimestamp DESC, o.id ASC LIMIT 500;"
webshopdb,9,1862.881,9.093,0.404,448,1859.096,37.368,0.835,50605,0.243,0.009,2.2557366398364283e-05,2.2040686590760885e-05,True,False,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT      p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MIN(ordertimestamp)     FROM ""order"" ) AND (p.category, p.id, p.name) IN (     SELECT          p2.category,         p2.id AS product_id,         p2.name AS product_name     FROM products p2     JOIN articles a2 ON a2.productid = p2.id     JOIN order_positions op2 ON op2.articleid = a2.id     JOIN ""order"" o2 ON o2.id = op2.orderid     WHERE o2.ordertimestamp >= (         SELECT MIN(ordertimestamp)         FROM ""order""     )     GROUP BY          p2.category,          p2.id,          p2.name ) GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,10,1665.822,1.832,0.231,37,1788.789,1.797,0.233,37,1.019,1.000,2.019639611372176e-05,2.1203645541263385e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT      c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING (MAX(o.ordertimestamp) < CURRENT_DATE - INTERVAL '6 months' OR MAX(o.ordertimestamp) IS NULL) ORDER BY last_order_timestamp NULLS FIRST LIMIT 200;"
webshopdb,11,1470.913,2.223,0.225,37,nan,,,,,,1.7815164893623954e-05,nan,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN (     SELECT DISTINCT o.customer AS customer_id     FROM ""order"" o     WHERE o.total > 100 ) sub ON sub.customer_id = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,12,1544.227,19.962,0.431,538,1662.542,26.738,0.429,538,0.747,1.000,1.8749959994495345e-05,1.9799913111497182e-05,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(COUNT(DISTINCT s.id), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(COUNT(DISTINCT s.id), 0) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,13,1673.031,13.604,0.374,444,1643.140,14.210,0.364,444,0.957,1.000,2.0062282057847902e-05,1.9562221659056646e-05,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT      date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,14,1948.944,13.252,0.483,462,nan,,,,,,2.3627576545085747e-05,nan,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT sub.category_id) AS categories_bought FROM customer c JOIN (     SELECT DISTINCT o.customer AS customer_id, p.category AS category_id     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     JOIN articles a ON a.id = op.articleid     JOIN products p ON p.id = a.productid     WHERE o.total > 100 ) sub ON sub.customer_id = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT sub.category_id) >= 3 ORDER BY categories_bought DESC, c.id;"
webshopdb,15,1827.600,11.557,0.598,566,1973.065,11.648,0.578,566,0.992,1.000,2.1878234122618034e-05,2.342823527023709e-05,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT      a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(COALESCE(s.count, 0)), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MAX(ordertimestamp) FROM ""order"") - INTERVAL '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(COALESCE(s.count, 0)), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,16,1658.749,7.324,0.219,425,1697.588,7.924,0.245,425,0.924,1.000,1.9905265087420822e-05,2.012246030847373e-05,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT  	p.id,  	p.name FROM products p LEFT JOIN ( 	SELECT DISTINCT a.productid AS product_id 	FROM articles a 	JOIN order_positions op ON op.articleid = a.id ) sub ON sub.product_id = p.id WHERE sub.product_id IS NULL;"
webshopdb,17,1970.186,394.304,0.368,128697,2238.993,975.609,0.370,54358,0.404,2.368,2.366480315444933e-05,2.654432197777571e-05,True,True,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT      p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric) FILTER (WHERE p2.category = p.category)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric) FILTER (WHERE p3.category = p.category)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid ) LIMIT 50;"
webshopdb,18,1789.807,4.581,0.109,3921,1659.919,2.004,0.168,37,2.286,105.973,2.141000278489077e-05,1.9619880714114023e-05,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      c.id,      c.firstname,      c.lastname FROM customer c JOIN (     SELECT o.customer AS customer_id, SUM(o.total::numeric) AS total_order_value     FROM ""order"" o     GROUP BY o.customer ) sub ON sub.customer_id = c.id ORDER BY sub.total_order_value DESC LIMIT 50;"
webshopdb,19,1838.972,1.823,0.113,2713,nan,,,,,,2.2240147193027912e-05,nan,False,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT      c.id,     c.firstname,     (         SELECT COUNT(*)         FROM ""order"" o         WHERE o.customer_id = c.id     ) AS total_orders FROM customer c;"
webshopdb,20,1681.248,0.892,0.064,19,nan,,,,,,2.0441629403333895e-05,nan,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      o.id,     o.ordertimestamp,     CAST(o.total AS numeric) FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12 AND o.total > 50;"
webshopdb,21,1865.315,15.214,0.375,493,1852.006,15.365,0.319,493,0.990,1.000,2.231674224501138e-05,2.1998269795567667e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(COALESCE(s.count, 0)), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;"
webshopdb,22,1494.052,0.030,0.091,1,1486.873,0.051,0.128,2,0.588,0.500,1.812704639594218e-05,1.7680975327439936e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;","SELECT      c.id,      c.firstname,      c.lastname,      c.email,      c.created  FROM      customer c  JOIN LATERAL (         SELECT * FROM unnest(ARRAY[(CURRENT_DATE - INTERVAL '30 days')::date]) AS t(created)     ) sub ON c.created = sub.created  ORDER BY      c.created DESC"
webshopdb,23,1646.250,8.438,0.324,425,1488.901,8.373,0.330,425,1.008,1.000,1.976378653499228e-05,1.7639288683251574e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY 3 DESC LIMIT 20;"
webshopdb,24,1468.702,0.065,0.515,4,1502.475,0.071,0.517,4,0.915,1.000,1.7787374096750733e-05,1.7795803316198634e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT CASE WHEN p.category IS NOT NULL THEN 1 END) >= 4 ORDER BY categories_bought DESC;"
webshopdb,25,1519.729,17.289,0.333,520,1662.055,19.903,0.354,520,0.869,1.000,1.8423683467057343e-05,1.993408572457992e-05,True,False,"WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     (total_sold * 1.0 / NULLIF(current_stock, 0)) AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;","SELECT      article_id,     description,     total_sold,     COALESCE(current_stock, 0) AS current_stock,     ((total_sold * 1.0) / COALESCE(NULLIF(current_stock, 0), 1)) AS demand_index FROM (     SELECT          a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) sub ORDER BY demand_index DESC NULLS LAST LIMIT 10;"
