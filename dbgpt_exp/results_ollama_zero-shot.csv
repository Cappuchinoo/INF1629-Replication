db,llm,prompt_technique,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,llama3.1:8b,zero-shot,1,2552.457,221.899,0.172,41037,2465.103,186.154,0.140,38037,8.281240852062445e-07,1.1987859729554455e-06,1.035,True,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT      c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     COALESCE(         (             SELECT SUM(o.total::numeric)             FROM ""order"" o             WHERE o.customer = c.id               AND date_trunc('year', o.ordertimestamp) =                  (SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order"")         ),         0     ) AS total_spent_last_year FROM customer c WHERE email IS NOT NULL ORDER BY COALESCE(     (         SELECT SUM(o2.total::numeric)         FROM ""order"" o2         WHERE o2.customer = c.id     ),     0 ) DESC;"
webshopdb,llama3.1:8b,zero-shot,2,3078.297,14.018,0.411,464,2986.762,13.458,0.412,464,1.2441548061900592e-06,1.00541008766338e-06,1.031,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT      a.id AS article_id,      p.name AS product_name,      a.originalprice,      a.reducedprice,      c.name AS color_name,     (random() * 1000000) :: integer AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL ORDER BY rnd;"
webshopdb,llama3.1:8b,zero-shot,3,2198.216,3.355,0.199,82,NaN,NaN,NaN,,1.0924277041971516e-06,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT      c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) ```  However, to optimize this query for PostgreSQL and decrease latency, we can use the following equivalent query:  ```sql SELECT      c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id = ANY (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) ```  This query uses the `ANY` operator instead of `IN`, which can be more efficient when dealing with large result sets."
webshopdb,llama3.1:8b,zero-shot,4,2680.398,2.153,0.216,56,2773.659,2.052,0.199,56,8.806626914527844e-07,9.192984252892234e-07,0.966,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT      c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC;"
webshopdb,llama3.1:8b,zero-shot,5,2360.244,79.645,0.195,16529,2260.408,2.367,0.162,37,1.1566512966996808e-06,1.1164131186146293e-06,1.044,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT      c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c JOIN ""order"" o ON c.id = o.customer GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC NULLS LAST;"
webshopdb,llama3.1:8b,zero-shot,6,1812.161,11.731,0.410,463,1811.988,12.706,0.431,463,7.331765090646205e-07,7.329119466838783e-07,1.000,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;"
webshopdb,llama3.1:8b,zero-shot,7,1954.147,1.361,0.188,37,NaN,NaN,NaN,,7.908491943527305e-07,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(*) >= 5 ORDER BY count DESC LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,8,2362.635,1.727,0.210,56,2365.268,1.742,0.204,56,1.0438978885519822e-06,1.045481192217232e-06,0.999,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT      o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500;"
webshopdb,llama3.1:8b,zero-shot,9,2463.312,9.487,0.332,463,2463.560,9.560,0.338,463,1.1973295437057833e-06,1.0730179479445503e-06,1.000,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;"
webshopdb,llama3.1:8b,zero-shot,10,2023.406,1.732,0.192,37,1910.668,1.880,0.198,37,9.522008658746007e-07,7.727222129873309e-07,1.059,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT      c.id,     c.firstname,     c.lastname,     o.ordertimestamp AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE (     (o.ordertimestamp < current_date - interval '6 months')     OR o.ordertimestamp IS NULL ) GROUP BY      c.id,      c.firstname,      c.lastname,      o.ordertimestamp HAVING COUNT(*) > 1 ORDER BY last_order_timestamp NULLS FIRST LIMIT 200;"
webshopdb,llama3.1:8b,zero-shot,11,1957.265,2.622,0.188,37,NaN,NaN,NaN,,7.914188686447615e-07,nan,NaN,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer_id = c.id  -- Corrected column name GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,llama3.1:8b,zero-shot,12,1850.683,21.694,0.345,538,1750.336,21.745,0.337,538,7.484597993701487e-07,7.079526890231982e-07,1.057,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) AS total_stock,     COALESCE(SUM(CASE WHEN op.amount IS NOT NULL THEN op.amount ELSE 0 END), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,llama3.1:8b,zero-shot,13,2052.628,13.868,0.279,444,2055.897,14.357,0.311,444,9.60093737129915e-07,1.0337440919300514e-06,0.998,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT      date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,llama3.1:8b,zero-shot,14,2150.461,14.390,0.371,462,2248.522,14.322,0.376,462,9.86735488130561e-07,1.1115917596416367e-06,0.956,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY COUNT(DISTINCT p.category) DESC, c.id;"
webshopdb,llama3.1:8b,zero-shot,15,2258.142,12.093,0.460,576,1848.892,0.388,0.428,21,1.0170188484643608e-06,7.487808534896881e-07,1.221,False,False,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT      a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= NOW() - INTERVAL '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(CASE WHEN s.count IS NOT NULL THEN s.count ELSE 0 END), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,llama3.1:8b,zero-shot,16,2568.183,9.365,0.239,425,NaN,NaN,NaN,,8.354699884673699e-07,nan,NaN,False,False,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT      p.id,     p.name FROM products p LEFT JOIN articles a ON p.id = a.productid LEFT JOIN (     SELECT articleid, productid FROM order_positions ) op ON a.id = op.articleid WHERE a.productid IS NULL;"
webshopdb,llama3.1:8b,zero-shot,17,2462.889,652.758,0.290,57022,NaN,NaN,NaN,,1.1979083959321007e-06,nan,NaN,False,False,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT      p.id,     p.name,     p.category,     a.reducedprice,     avg_category_price FROM (     SELECT DISTINCT on (p.category)          p.id,          p.name,          p.category,          a.reducedprice,         AVG(a2.reducedprice::numeric) OVER (PARTITION BY p.category) AS avg_category_price     FROM products p     JOIN articles a ON a.productid = p.id     JOIN articles a2 ON a2.productid = p.id ) subquery JOIN LATERAL (     SELECT AVG(reducedprice::numeric) AS threshold     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = subquery.category ) threshold ON TRUE WHERE reducedprice > threshold.threshold LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,18,2259.833,85.906,0.124,19018,2111.028,2.389,0.191,37,1.0159901463313251e-06,1.0568775032248534e-06,1.070,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      id,      firstname,      lastname FROM (     SELECT          c.id,          c.firstname,          c.lastname,         SUM(o.total::numeric) AS total_spent     FROM customer c     LEFT JOIN ""order"" o ON o.customer = c.id     GROUP BY c.id, c.firstname, c.lastname ) AS subquery ORDER BY total_spent DESC LIMIT 50;"
webshopdb,llama3.1:8b,zero-shot,19,2361.887,77.424,0.100,17080,NaN,NaN,NaN,,1.044494001008799e-06,nan,NaN,False,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","EXPLAIN ANALYZE SELECT      c.id,     c.firstname,     coalesce((SELECT count(*) FROM ""order"" o WHERE o.customer = c.id), 0) AS total_orders FROM customer c WHERE c.id < 1000; ```  Note: This query uses `COALESCE` to avoid a subquery that returns no rows (which can be slow in PostgreSQL). The `EXPLAIN ANALYZE` statement is used to analyze the performance of the query."
webshopdb,llama3.1:8b,zero-shot,20,1952.798,0.890,0.060,19,2159.995,0.938,0.062,19,7.895037865629786e-07,9.894860935880294e-07,0.904,True,True,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      id,     ordertimestamp,     total FROM ""order"" WHERE EXTRACT(MONTH FROM ordertimestamp) = 12   AND total::numeric > 50;"
