db,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
shopmall,1,13.931,0.038,0.265,0,9.498,0.036,0.238,0,1.467,True,True,SELECT COUNT(*) FROM table_3;,SELECT COUNT(*)  FROM table_3;
shopmall,2,19.211,0.085,0.499,0,24.911,0.135,0.592,3,0.771,True,True,SELECT COUNT(*)  FROM table_3 WHERE column_22 >= DATE '2019-01-01'   AND column_22 < DATE '2021-01-01';,"SELECT COUNT(*)  FROM (     SELECT column_22,      ROW_NUMBER() OVER (ORDER BY column_22) AS row_num      FROM table_3 ) t1 WHERE t1.row_num >= 1 AND t1.column_22 < DATE '2021-01-01' AND t1.column_22 >= DATE '2019-01-01';"
shopmall,3,22.972,0.148,0.599,3,18.667,0.209,0.581,3,1.231,True,True,"SELECT column_1, COUNT(*) FROM table_3 GROUP BY column_1 ORDER BY COUNT(*) DESC LIMIT 20;","SELECT      column_1,     COUNT(*) AS count FROM      table_3 GROUP BY      column_1 ORDER BY      count DESC LIMIT 20;"
shopmall,4,18.916,0.090,0.508,0,18.466,0.133,0.525,0,1.024,True,True,"SELECT      MIN(column_6),     MAX(column_6),     AVG(column_6) FROM table_3;","SELECT      MIN(column_6) AS min_column_6,     MAX(column_6) AS max_column_6,     AVG(column_6) AS avg_column_6 FROM (     SELECT column_6 FROM table_3 GROUP BY column_6 ) AS temp;"
shopmall,5,18.694,0.055,0.506,0,17.081,0.051,0.446,0,1.094,True,True,SELECT COUNT(*) FROM table_3 WHERE column_6 > 0;,SELECT COUNT(*) FROM table_3 AS t3 WHERE column_6 > 0;
webshopdb,1,2552.272,185.056,0.141,41037,2022.932,178.581,0.139,38037,1.262,True,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC;","SELECT      c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     COALESCE((SELECT SUM(o.total::numeric)               FROM ""order"" o               WHERE o.customer = c.id                 AND date_trunc('year', o.ordertimestamp) = (                     SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""                 )             ), 0) AS total_spent_last_year FROM customer c WHERE email IS NOT NULL ORDER BY COALESCE((SELECT SUM(o2.total::numeric)                    FROM ""order"" o2                    WHERE o2.customer = c.id), 0) DESC;"
webshopdb,2,2942.903,17.130,0.419,464,2532.589,13.539,0.408,464,1.162,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd;","SELECT DISTINCT      a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL ORDER BY rnd;"
webshopdb,3,1912.632,3.690,0.200,82,1864.585,3.359,0.190,82,1.026,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 );","SELECT      c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id = ANY (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 );"
webshopdb,4,2170.589,2.343,0.224,56,nan,,,,,False,False,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC;","SELECT DISTINCT      c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN order o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM order) ORDER BY o.ordertimestamp DESC;"
webshopdb,5,1944.017,76.711,0.184,16529,1943.525,2.470,0.172,37,1.000,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST;","SELECT      c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c JOIN ""order"" o ON c.id = o.customer GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC NULLS LAST;"
webshopdb,6,1543.286,12.244,0.384,463,nan,,,,,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE    o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10; ```  In PostgreSQL, you can use the following index on `products` table to speed up the query: ```sql CREATE INDEX idx_products_currentlyactive ON products (currentlyactive); ``` Also, create an index on `articles` and `order_positions` tables: ```sql CREATE INDEX idx_articles_productid ON articles (productid); CREATE INDEX idx_order_positions_articleid ON order_positions (articleid); CREATE INDEX idx_order_positions_order_id ON order_positions (orderid); ```  Additionally, you can consider creating a composite index on the join columns of `articles`, `order_positions` and `""order""` tables: ```sql CREATE INDEX idx_articles_order_positions ON articles (productid) WHERE productid IS NOT NULL; CREATE INDEX idx_order_positions_order ON order_positions (articleid, orderid); ``` Note: Be sure to run these index creation queries in a maintenance window when the database is not under heavy load."
webshopdb,7,1737.068,1.302,0.179,37,1684.202,1.266,0.204,37,1.031,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(*) >= 5 ORDER BY COUNT(*) DESC LIMIT 50;"
webshopdb,8,1905.172,1.686,0.193,56,1918.486,1.744,0.218,56,0.993,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500;","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (     SELECT MIN(ordertimestamp)      FROM ""order"" ) ORDER BY o.ordertimestamp DESC LIMIT 500;"
webshopdb,9,1929.563,9.921,0.323,463,1902.315,10.753,0.338,463,1.014,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;","SELECT      p.category,     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(op.amount), 0) AS total_qty FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN order_positions op ON op.articleid = a.id LEFT JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;"
webshopdb,10,1708.054,1.735,0.190,37,nan,,,,,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200;","SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE (MAX(o.ordertimestamp) < (CURRENT_DATE - INTERVAL '6 months')         OR MAX(o.ordertimestamp) IS NULL) GROUP BY c.id, c.firstname, c.lastname ORDER BY last_order_timestamp NULLS FIRST LIMIT 200;"
