db,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,buffers_ratio,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,1,1815.917,9.309,0.170,10828,1777.826,6.006,0.216,3944,1.550,2.745,2.15323756158972e-05,2.1112916697158236e-05,True,True,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT     c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     sub.total_spent_last_year FROM customer c LEFT JOIN (     SELECT o.customer AS customer_id, SUM(o.total::numeric) AS total_spent_last_year     FROM ""order"" o     WHERE date_trunc('year', o.ordertimestamp) = (         SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""     )     GROUP BY o.customer ) sub ON sub.customer_id = c.id WHERE c.email IS NOT NULL ORDER BY (     SELECT SUM(o2.total::numeric)     FROM ""order"" o2     WHERE o2.customer = c.id ) DESC;"
webshopdb,2,2272.041,12.771,0.587,449,2271.306,11.196,0.468,449,1.141,1.000,2.7039931500789338e-05,2.772299773658433e-05,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT a.id AS article_id, p.name AS product_name, a.originalprice, a.reducedprice, c.name AS color_name, random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY rnd;"
webshopdb,3,1732.004,3.449,0.216,82,1768.725,3.321,0.211,82,1.039,1.000,2.0998412021330504e-05,2.1381773360382197e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c JOIN (     SELECT DISTINCT o.customer AS customer_id     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 ) sub ON sub.customer_id = c.id;"
webshopdb,4,1918.873,1.838,0.256,41,1924.237,1.472,0.239,41,1.249,1.000,2.3465984305305567e-05,2.283677294615009e-05,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT c.id, c.firstname, c.lastname, o.id AS order_id, o.ordertimestamp FROM customer c JOIN (     SELECT o.id, o.customer, o.ordertimestamp     FROM ""order"" o     WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ) o ON o.customer = c.id ORDER BY o.ordertimestamp DESC;"
webshopdb,5,1761.919,4.913,0.230,3676,1769.804,2.037,0.140,37,2.412,99.351,2.1585071789688588e-05,2.1515954580107634e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT     c.id,     c.firstname,     c.lastname,     sub.total_spent FROM customer c JOIN (     SELECT o.customer, SUM(o.total::numeric) AS total_spent     FROM ""order"" o     GROUP BY o.customer ) sub ON sub.customer = c.id ORDER BY sub.total_spent DESC NULLS LAST;"
webshopdb,6,1440.224,11.337,0.584,448,1456.902,11.295,0.498,448,1.004,1.000,1.7269708294413606e-05,1.8199847215193247e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;"
webshopdb,7,1595.018,1.303,0.252,37,1603.759,0.820,0.158,37,1.589,1.000,1.8983978997289256e-05,1.9088443077078226e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT c.id, c.firstname, c.lastname, cnt.num_orders FROM customer c JOIN (     SELECT o.customer AS customer_id, COUNT(o.id) AS num_orders     FROM ""order"" o     GROUP BY o.customer ) cnt ON cnt.customer_id = c.id WHERE cnt.num_orders >= 5 ORDER BY cnt.num_orders DESC LIMIT 50;"
webshopdb,8,1775.331,1.487,0.250,41,1790.519,1.024,0.199,1687,1.452,0.024,2.1115561551676023e-05,2.137267648041946e-05,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer ORDER BY o.ordertimestamp DESC LIMIT 500;"
webshopdb,9,1887.169,9.284,0.410,448,1743.798,10.221,0.373,444,0.908,1.009,2.2428070467656164e-05,2.070684074135809e-05,True,False,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;"
webshopdb,10,1593.432,1.741,0.225,37,1620.881,1.495,0.154,37,1.165,1.000,1.898519176071515e-05,1.926622066594224e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT     c.id,     c.firstname,     c.lastname,     o.last_order_timestamp FROM customer c LEFT JOIN (     SELECT         o.customer,         MAX(o.ordertimestamp) AS last_order_timestamp     FROM ""order"" o     GROUP BY o.customer ) o ON o.customer = c.id WHERE o.last_order_timestamp < current_date - interval '6 months'    OR o.last_order_timestamp IS NULL ORDER BY o.last_order_timestamp NULLS FIRST LIMIT 200;"
webshopdb,11,1458.206,2.268,0.229,37,1418.122,2.489,0.228,37,0.911,1.000,1.7384136522942414e-05,1.6872657496496146e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY AVG(o.total::numeric) DESC LIMIT 20;"
webshopdb,12,1458.334,21.690,0.409,538,1452.821,20.509,0.411,538,1.058,1.000,1.7469961820302136e-05,1.7337035653942404e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING SUM(s.count) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,13,1633.632,13.227,0.359,444,nan,,,,,,1.9401116408901123e-05,nan,False,False,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     month,     p.category,     revenue FROM (     SELECT         date_trunc('month', o.ordertimestamp) AS month,         p.category,         SUM(op.amount * op.price::numeric) AS revenue     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     JOIN articles a ON a.id = op.articleid     JOIN products p ON p.id = a.productid     GROUP BY month, p.category ) sub ORDER BY month, revenue DESC;"
webshopdb,14,1788.962,14.529,0.552,462,nan,,,,,,2.123990779515823e-05,nan,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     JOIN articles a ON a.id = op.articleid     JOIN products p ON p.id = a.productid     GROUP BY o.customer     HAVING COUNT(DISTINCT p.category) >= 3 ) sub ON sub.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname ORDER BY categories_bought DESC, c.id;"
webshopdb,15,1718.292,11.514,0.592,566,1773.750,11.576,0.597,561,0.995,1.009,2.0395547405350026e-05,2.1016568447204306e-05,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MAX(ordertimestamp) - interval '1 year' FROM ""order"" ) GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,16,1596.958,6.966,0.238,425,1595.060,7.111,0.223,425,0.980,1.000,1.896073338772488e-05,1.892810044933662e-05,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT p.id, p.name FROM products p LEFT JOIN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id ) sub ON sub.productid = p.id WHERE sub.productid IS NULL;"
webshopdb,17,1877.980,390.108,0.372,128697,1577.221,9.820,0.309,388,39.726,331.693,2.2301776360772594e-05,1.8710274991127758e-05,True,True,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT     p.id,     p.name,     p.category,     a.reducedprice,     avg_cat_price.avg_category_price FROM products p JOIN articles a ON a.productid = p.id JOIN (     SELECT p2.category, AVG(a2.reducedprice::numeric) AS avg_category_price     FROM articles a2     JOIN products p2 ON p2.id = a2.productid     GROUP BY p2.category ) avg_cat_price ON avg_cat_price.category = p.category WHERE a.reducedprice::numeric > avg_cat_price.avg_category_price LIMIT 50;"
webshopdb,18,1630.054,4.333,0.111,3921,1612.498,2.043,0.153,37,2.121,105.973,1.9404456765625742e-05,1.9226177411051614e-05,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      c.id,      c.firstname,      c.lastname FROM customer c JOIN (     SELECT o.customer AS customer_id, SUM(o.total::numeric) AS total_sum     FROM ""order"" o     GROUP BY o.customer ) sub ON sub.customer_id = c.id ORDER BY sub.total_sum DESC  LIMIT 50;"
webshopdb,19,1777.147,1.888,0.103,2713,1811.741,1.125,0.147,37,1.678,73.324,2.111510160134372e-05,2.158593358282152e-05,True,True,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT      c.id,     c.firstname,     coalesce(o.total_orders, 0) AS total_orders FROM      customer c LEFT JOIN      (SELECT customer, COUNT(*) AS total_orders FROM ""order"" GROUP BY customer) o  ON      o.customer = c.id WHERE      c.id < 1000;"
webshopdb,20,1602.097,0.889,0.065,19,nan,,,,,,1.9095962068891606e-05,nan,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE o.ordertimestamp >= DATE_TRUNC('month', o.ordertimestamp) + INTERVAL '11 months'   AND o.ordertimestamp < DATE_TRUNC('month', o.ordertimestamp) + INTERVAL '12 months'   AND o.total > 50;"
webshopdb,21,1760.888,17.273,0.337,493,nan,,,,,,2.090709043012101e-05,nan,False,False,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN (      SELECT a.productid, s.count     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id ) sub ON sub.productid = p.id GROUP BY p.id, p.name ORDER BY total_stock DESC;"
webshopdb,22,1440.858,0.027,0.084,1,1411.043,0.029,0.096,1,0.931,1.000,1.7107363247454486e-05,1.6846299931336855e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;","SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;"
webshopdb,23,1424.857,8.371,0.333,425,1434.007,8.408,0.349,425,0.996,1.000,1.688181773099994e-05,1.6951277332148187e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN order_positions op ON op.articleid IN (     SELECT a.id     FROM articles a     WHERE a.productid = p.id ) GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;"
webshopdb,24,1452.910,0.068,0.518,4,1446.049,0.070,0.498,4,0.971,1.000,1.720543988509778e-05,1.7131757920568797e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;"
webshopdb,25,1472.836,17.546,0.324,520,1415.762,16.298,0.282,520,1.077,1.000,1.7498860846207144e-05,1.6832958491132306e-05,True,True,"WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     (total_sold * 1.0 / NULLIF(current_stock, 0)) AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;","SELECT     a.id AS article_id,     a.description,     SUM(op.amount) AS total_sold,     COALESCE(SUM(s.count), 0) AS current_stock,     (SUM(op.amount) * 1.0 / NULLIF(COALESCE(SUM(s.count), 0), 0)) AS demand_index FROM articles a LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id GROUP BY a.id, a.description ORDER BY demand_index DESC NULLS LAST LIMIT 10;"
