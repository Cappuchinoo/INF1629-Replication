db,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,buffers_ratio,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,1,1776.118,9.675,0.192,10828,1787.873,7.976,0.151,7828,1.213,1.383,2.115785033305077e-05,2.1252290090318343e-05,True,True,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT     c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL ORDER BY (     SELECT SUM(o2.total::numeric)     FROM ""order"" o2     WHERE o2.customer = c.id ) DESC"
webshopdb,2,2251.617,12.329,0.487,449,2273.046,20.440,0.579,561,0.603,0.800,2.6736961287821184e-05,2.6925590408365166e-05,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" WHERE id IN (SELECT DISTINCT orderid FROM order_positions WHERE articleid IN (SELECT id FROM articles))) ORDER BY rnd"
webshopdb,3,1726.946,3.363,0.215,82,1786.954,3.612,0.285,82,0.931,1.000,2.0692695770852507e-05,2.1243409789713135e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE EXISTS (     SELECT 1     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 AND o.customer = c.id )"
webshopdb,4,1984.870,2.021,0.270,41,1961.454,1.902,0.268,41,1.063,1.000,2.3635608961750637e-05,2.3387945900001133e-05,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) ORDER BY o.ordertimestamp DESC"
webshopdb,5,1769.917,4.941,0.233,3676,1769.873,3.199,0.254,56,1.545,65.643,2.130048721532095e-05,2.0984193454875035e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT     c.id,     c.firstname,     c.lastname,     o.total_spent FROM customer c LEFT JOIN (     SELECT         customer,         SUM(total::numeric) AS total_spent     FROM ""order""     GROUP BY customer ) o ON c.id = o.customer WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY o.total_spent DESC NULLS LAST"
webshopdb,6,1470.677,11.394,0.513,448,1471.960,11.315,0.461,448,1.007,1.000,1.748924908717134e-05,1.7436391079824066e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1)   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10"
webshopdb,7,1665.590,3.647,0.216,37,1659.332,1.281,0.248,37,2.847,1.000,1.980813748759405e-05,1.9657416804423612e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50"
webshopdb,8,1781.002,1.522,0.313,41,1789.112,1.511,0.254,41,1.007,1.000,2.109466736746151e-05,2.1234728738273668e-05,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) ORDER BY o.ordertimestamp DESC LIMIT 500"
webshopdb,9,1872.054,9.382,0.419,448,1806.185,10.441,0.453,448,0.899,1.000,2.222052962284506e-05,2.1457539047525646e-05,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,10,1626.865,1.723,0.220,37,1630.420,1.804,0.227,37,0.955,1.000,1.9352687463793124e-05,1.9369893819287468e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'    OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200"
webshopdb,11,1442.995,2.336,0.226,37,1475.587,6.275,0.266,6262,0.372,0.006,1.7150806255505383e-05,1.7477732696651624e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id WHERE EXISTS (     SELECT 1 FROM ""order"" o2     WHERE o2.customer = c.id     GROUP BY o2.customer     HAVING COUNT(o2.id) >= 3 ) GROUP BY c.id, c.firstname, c.lastname ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,12,1498.801,28.669,0.411,538,1502.736,20.627,0.439,538,1.390,1.000,1.7798669127627162e-05,1.783191490404577e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN (     SELECT articleid, count FROM stock     WHERE count IS NOT NULL ) s ON s.articleid = a.id LEFT JOIN (     SELECT articleid, amount FROM order_positions     WHERE amount IS NOT NULL ) op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,13,1612.016,13.506,0.354,444,1623.765,13.718,0.391,444,0.985,1.000,1.9214115407506335e-05,1.940674706871528e-05,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,14,1848.608,13.406,0.431,462,1843.859,14.659,0.554,462,0.915,1.000,2.2243881548164375e-05,2.1877559751546472e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;"
webshopdb,15,1894.558,11.621,0.604,566,1802.857,12.200,0.680,566,0.953,1.000,2.25514313144511e-05,2.1410612717905516e-05,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","WITH bounds AS (     SELECT MAX(ordertimestamp) AS max_ts FROM ""order"" ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid JOIN bounds b ON TRUE WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,16,1769.211,6.844,0.221,425,1661.132,6.858,0.263,425,0.998,1.000,2.0938955995419836e-05,1.9705887625061487e-05,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT     p.id,     p.name FROM products p WHERE NOT EXISTS (     SELECT 1     FROM articles a     JOIN order_positions op ON op.articleid = a.id     WHERE a.productid = p.id );"
webshopdb,17,1912.274,390.525,0.429,128697,1628.926,10.110,0.313,388,38.628,331.693,2.271325354767175e-05,1.9251536256411177e-05,True,True,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT     p.id,     p.name,     p.category,     a.reducedprice,     c.avg_price AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id JOIN (     SELECT         p4.category,         AVG(a4.reducedprice::numeric) AS avg_price     FROM articles a4     JOIN products p4 ON p4.id = a4.productid     GROUP BY p4.category ) c ON p.category = c.category WHERE a.reducedprice::numeric > c.avg_price LIMIT 50;"
webshopdb,18,1640.210,4.210,0.123,3921,1593.338,1.998,0.149,37,2.107,105.973,1.9525051650574805e-05,1.891606110070877e-05,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT c.id, c.firstname, c.lastname FROM customer c JOIN (     SELECT customer, SUM(total::numeric) as total_spent     FROM ""order""     GROUP BY customer ) o ON c.id = o.customer ORDER BY o.total_spent DESC LIMIT 50;"
webshopdb,19,1782.842,1.819,0.100,2713,1735.596,1.153,0.134,37,1.578,73.324,2.1186881158322506e-05,2.0568093258706134e-05,True,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT     c.id,     c.firstname,     o.total_orders FROM customer c LEFT JOIN (     SELECT customer, COUNT(*) AS total_orders     FROM ""order""     GROUP BY customer ) o ON c.id = o.customer WHERE c.id < 1000;"
webshopdb,20,1631.727,0.902,0.064,19,nan,,,,,,1.9344930636129923e-05,nan,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT     o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE o.ordertimestamp >= '2000-12-01'   AND o.ordertimestamp < '2001-01-01'   AND o.total > 50"
webshopdb,21,1788.114,15.471,0.409,493,1759.398,15.296,0.323,493,1.011,1.000,2.122349489766819e-05,2.084066761794184e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN LATERAL (     SELECT a.id     FROM articles a     WHERE a.productid = p.id ) a ON true LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;"
webshopdb,22,1463.064,0.028,0.085,1,1455.206,0.030,0.088,1,0.933,1.000,1.739793400272791e-05,1.7304299379920976e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;","SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC LIMIT 1000;"
webshopdb,23,1465.152,8.557,0.326,425,1414.749,8.416,0.334,425,1.017,1.000,1.7384349149206497e-05,1.6890943619034736e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;"
webshopdb,24,1479.023,0.068,0.524,4,1480.088,0.101,0.638,4,0.673,1.000,1.756636060412493e-05,1.752810520451381e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= (CURRENT_DATE - INTERVAL '6 months') GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC LIMIT 1000;"
webshopdb,25,1443.762,17.129,0.377,520,1465.956,17.250,0.355,520,0.993,1.000,1.7126777753890633e-05,1.742985145370979e-05,True,True,"WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     (total_sold * 1.0 / NULLIF(current_stock, 0)) AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;","WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     CASE         WHEN current_stock = 0 THEN NULL         ELSE (total_sold * 1.0 / current_stock)     END AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;"
