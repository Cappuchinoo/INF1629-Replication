db,llm,prompt_technique,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,mistral-small-latest,few-shot,1,1910.845,183.358,0.140,41037,1910.763,180.460,0.130,38037,2.275533087899827e-05,2.293378824643198e-05,1.000,True,True,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT     c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL ORDER BY (     SELECT SUM(o2.total::numeric)     FROM ""order"" o2     WHERE o2.customer = c.id ) DESC"
webshopdb,mistral-small-latest,few-shot,2,2199.961,14.317,0.421,464,1416.939,1.265,0.373,91,2.5921177762017117e-05,1.6825148652695112e-05,1.553,False,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp = (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY rnd"
webshopdb,mistral-small-latest,few-shot,3,1704.332,3.348,0.193,82,1720.388,3.407,0.228,82,2.0148292408782718e-05,2.0371729365944308e-05,0.991,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE EXISTS (     SELECT 1     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 AND o.customer = c.id )"
webshopdb,mistral-small-latest,few-shot,4,1878.586,2.126,0.202,56,1876.870,2.060,0.205,56,2.255760860847726e-05,2.229015637973885e-05,1.001,True,True,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) ORDER BY o.ordertimestamp DESC"
webshopdb,mistral-small-latest,few-shot,5,1813.296,77.404,0.208,16529,1706.264,2.011,0.124,37,2.1470783849836746e-05,2.0168538545061537e-05,1.063,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT c.id, c.firstname, c.lastname, o.total_spent FROM customer c JOIN (     SELECT customer, SUM(total::numeric) AS total_spent     FROM ""order""     GROUP BY customer ) o ON c.id = o.customer ORDER BY o.total_spent DESC NULLS LAST"
webshopdb,mistral-small-latest,few-shot,6,1433.421,11.778,0.376,463,1677.796,896.114,0.371,44424,1.6871583980870563e-05,1.984261477575046e-05,0.854,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" WHERE o.id IS NOT NULL)   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10"
webshopdb,mistral-small-latest,few-shot,7,1552.769,1.281,0.181,37,1582.979,1.280,0.182,37,1.8402816084330193e-05,1.8716525999272738e-05,0.981,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50"
webshopdb,mistral-small-latest,few-shot,8,1734.647,1.749,0.198,56,1705.983,1.726,0.197,56,2.0479451757967228e-05,2.0169967862969992e-05,1.017,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) ORDER BY o.ordertimestamp DESC LIMIT 500"
webshopdb,mistral-small-latest,few-shot,9,1727.170,9.509,0.329,463,1707.886,9.724,0.354,463,2.0398457858751347e-05,2.009958276339798e-05,1.011,True,True,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"" LIMIT 1) GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,mistral-small-latest,few-shot,10,1559.761,1.758,0.186,37,1712.382,87.324,0.161,19021,1.8439655360183965e-05,2.01965216817089e-05,0.911,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT c.id, c.firstname, c.lastname, MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN LATERAL (     SELECT o.ordertimestamp     FROM ""order"" o     WHERE o.customer = c.id     ORDER BY o.ordertimestamp DESC     LIMIT 1 ) o ON true GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'    OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200"
webshopdb,mistral-small-latest,few-shot,11,1406.857,2.264,0.187,37,1397.745,2.255,0.183,37,1.6684241262622908e-05,1.6521925167989805e-05,1.007,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,mistral-small-latest,few-shot,12,1407.128,20.500,0.298,538,1430.133,34.482,0.399,642,1.661872877341533e-05,1.6894530802110878e-05,0.984,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN (     SELECT articleid, count     FROM stock     WHERE articleid IN (SELECT id FROM articles) ) s ON s.articleid = a.id LEFT JOIN (     SELECT articleid, amount     FROM order_positions     WHERE articleid IN (SELECT id FROM articles) ) op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10 ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,mistral-small-latest,few-shot,13,1578.875,13.355,0.275,444,1572.092,13.318,0.276,444,1.8663856428546906e-05,1.8584300235213058e-05,1.004,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE p.category IS NOT NULL GROUP BY month, p.category ORDER BY month, revenue DESC;"
webshopdb,mistral-small-latest,few-shot,14,1716.858,13.304,0.378,462,1936.996,547.221,0.525,131958,2.0317548822481732e-05,2.2875757407553275e-05,0.886,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE EXISTS (     SELECT 1     FROM order_positions op2     JOIN articles a2 ON a2.id = op2.articleid     JOIN products p2 ON p2.id = a2.productid     WHERE op2.orderid = o.id     GROUP BY p2.category     HAVING COUNT(DISTINCT p2.category) >= 3 ) GROUP BY c.id, c.firstname, c.lastname ORDER BY categories_bought DESC, c.id;"
webshopdb,mistral-small-latest,few-shot,15,1722.556,12.479,0.484,576,1745.643,12.514,0.508,576,2.0445222329798745e-05,2.0621163660950597e-05,0.987,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","WITH bounds AS (     SELECT MAX(ordertimestamp) AS max_ts FROM ""order"" ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN (SELECT max_ts FROM bounds) b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
