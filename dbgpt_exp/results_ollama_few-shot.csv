db,llm,prompt_technique,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,llama3.1:8b,few-shot,1,2872.698,186.560,0.136,41037,NaN,NaN,NaN,,9.588060735889e-07,nan,NaN,False,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT    c.id AS customer_id,   (c.firstname || ' ' || c.lastname) AS full_name,   (     SELECT SUM(o.total::numeric)     FROM ""order"" o     JOIN (       SELECT MIN(ordertimestamp) min_ordertimestamp, o.customer       FROM ""order""       GROUP BY o.customer     ) AS ord ON (o.ordertimestamp = ord.min_ordertimestamp AND o.customer = ord.customer)     WHERE o.customer = c.id   ) AS total_spent_last_year,   SUM(o.total::numeric) AS total_spent FROM customer c JOIN ""order"" o ON (c.id = o.customer) WHERE c.email IS NOT NULL GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC;"
webshopdb,llama3.1:8b,few-shot,2,3428.862,13.368,0.455,464,2947.094,13.444,0.389,464,1.2649121177658836e-06,9.885060155542694e-07,1.163,True,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT DISTINCT      a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MIN(ordertimestamp)     FROM ""order"" ) AND p.name IS NOT NULL ORDER BY rnd;"
webshopdb,llama3.1:8b,few-shot,3,2637.176,3.361,0.194,82,2295.419,3.401,0.196,82,8.639233573796859e-07,1.0250375955065257e-06,1.149,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT      c.id,      c.firstname,      c.lastname,      c.email  FROM customer c  INNER JOIN (     SELECT DISTINCT o.customer      FROM ""order"" o      JOIN order_positions op ON op.orderid = o.id      WHERE op.amount >= 1 ) as o  ON (c.id = o.customer);"
webshopdb,llama3.1:8b,few-shot,4,2560.878,2.063,0.200,56,NaN,NaN,NaN,,8.33126702275982e-07,nan,NaN,False,False,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT DISTINCT      c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN (     SELECT id, ordertimestamp, ROW_NUMBER() OVER (ORDER BY ordertimestamp DESC) rn     FROM ""order"" ) o ON o.customer = c.id AND o.rn = 1;"
webshopdb,llama3.1:8b,few-shot,5,2254.173,78.295,0.191,16529,2362.975,2.447,0.196,37,1.01573877781274e-06,1.157760177452939e-06,0.954,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT      c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c INNER JOIN ""order"" o ON c.id = o.customer GROUP BY c.id, c.firstname, c.lastname ORDER BY total_spent DESC NULLS LAST;"
webshopdb,llama3.1:8b,few-shot,6,1953.386,13.279,0.430,463,1943.903,11.931,0.382,463,7.902762950119965e-07,7.861383037487999e-07,1.005,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT      p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MIN(ordertimestamp)     FROM ""order"" ) AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10;"
webshopdb,llama3.1:8b,few-shot,7,1960.915,1.316,0.186,37,2052.520,1.533,0.177,37,7.931336507246092e-07,1.0321387207429581e-06,0.955,False,False,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname ORDER BY COUNT(*) DESC LIMIT 50;"
webshopdb,llama3.1:8b,few-shot,8,1924.546,1.695,0.199,56,NaN,NaN,NaN,,7.796013299833243e-07,nan,NaN,False,False,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT      o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM (     SELECT          id,         ordertimestamp,         customer,         ROW_NUMBER() OVER (ORDER BY ordertimestamp DESC) AS rn     FROM ""order"" ) o JOIN customer c ON c.id = o.customer WHERE o.rn <= 500;"
webshopdb,llama3.1:8b,few-shot,9,2364.562,9.471,0.331,463,2133.206,10.064,0.390,481,1.0448415083798531e-06,1.0645570465975809e-06,1.108,True,False,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT      p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MIN(ordertimestamp)     FROM ""order"" ) AND p.category IN (     SELECT category      FROM products      GROUP BY category HAVING COUNT(*) > 1 ) GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC;"
webshopdb,llama3.1:8b,few-shot,10,2153.254,1.712,0.189,37,2105.063,1.599,0.174,37,1.0719031025414297e-06,9.748003115958882e-07,1.023,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT      c.id,     c.firstname,     c.lastname,     o.ordertimestamp AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE (o.ordertimestamp IS NULL OR o.ordertimestamp < current_date - interval '6 months') ORDER BY o.ordertimestamp NULLS FIRST LIMIT 200;"
webshopdb,llama3.1:8b,few-shot,11,1802.738,2.315,0.195,37,1851.166,2.247,0.191,37,7.291051446391861e-07,7.48604313046954e-07,0.974,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(*) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(*) >= 3 ORDER BY avg_order_value DESC LIMIT 20"
webshopdb,llama3.1:8b,few-shot,12,1943.504,20.191,0.283,538,2053.834,21.106,0.379,538,7.86394083147443e-07,9.599927829096435e-07,0.946,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(CASE WHEN s.count IS NULL THEN 0 ELSE s.count END), 0) AS total_stock,     COALESCE(SUM(CASE WHEN op.amount IS NULL THEN 0 ELSE op.amount END), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(CASE WHEN s.count IS NULL THEN 0 ELSE s.count END), 0) < 10  ORDER BY total_stock ASC, total_sold DESC;"
webshopdb,llama3.1:8b,few-shot,13,2054.248,13.231,0.284,444,2156.932,13.274,0.282,444,9.612585303379612e-07,9.882260844814962e-07,0.952,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT      date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY 1, 2 ORDER BY 1, 3 DESC;"
webshopdb,llama3.1:8b,few-shot,14,2431.495,13.610,0.367,462,2463.195,13.869,0.357,462,1.063538646755641e-06,1.1980800298253278e-06,0.987,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT      c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id"
webshopdb,llama3.1:8b,few-shot,15,2331.147,12.084,0.474,576,2359.825,12.173,0.492,576,1.1443284826323048e-06,1.0436497938373545e-06,0.988,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (     SELECT MAX(ordertimestamp) - INTERVAL '1 year'     FROM ""order"" ) GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,llama3.1:8b,few-shot,16,2018.509,7.254,0.155,425,2055.073,7.393,0.225,425,1.0177342598068369e-06,1.0327291536705598e-06,0.982,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT      p.id,      p.name FROM      products p LEFT JOIN      (SELECT DISTINCT a.productid       FROM articles a       JOIN order_positions op ON op.articleid = a.id) as o ON p.id = o.productid WHERE      o.productid IS NULL;"
webshopdb,llama3.1:8b,few-shot,17,2552.626,612.822,0.286,57022,NaN,NaN,NaN,,8.298517491717272e-07,nan,NaN,False,False,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT      p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric) AS avg         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM      products p JOIN      articles a ON a.productid = p.id WHERE      a.reducedprice::numeric > (         SELECT AVG(a3.reducedprice::numeric) AS avg         FROM articles a3         JOIN products p3 ON p3.id = a3.productid         WHERE p3.category = p.category     ) JOIN LATERAL (     SELECT AVG(a2.reducedprice::numeric) AS avg, t2.category     FROM articles a2     JOIN products t2 ON t2.id = a2.productid     WHERE t2.category = p.category ) AS t (avg, category) ON (p.category = category AND a.reducedprice::numeric > avg) LIMIT 50;"
webshopdb,llama3.1:8b,few-shot,18,2331.296,87.528,0.094,19018,2566.839,1.975,0.137,37,1.1463243874364481e-06,8.363389877070067e-07,0.908,True,False,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      c.id,      c.firstname,      c.lastname FROM customer c INNER JOIN (     SELECT          o.customer,         SUM(o.total::numeric) total     FROM ""order"" o     GROUP BY o.customer ) AS orders ON (c.id = orders.customer) ORDER BY orders.total DESC LIMIT 50;"
webshopdb,llama3.1:8b,few-shot,19,2315.476,77.498,0.086,17080,2428.790,76.950,0.100,17080,1.1378091940091253e-06,1.0627159319827222e-06,0.953,True,True,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT      c.id,     c.firstname,     COALESCE((SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id), 0) AS total_orders FROM customer c WHERE c.id < 1000;"
webshopdb,llama3.1:8b,few-shot,20,2360.855,0.909,0.071,19,NaN,NaN,NaN,,1.0432738913068225e-06,nan,NaN,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o INNER JOIN (     SELECT          EXTRACT(MONTH FROM o.ordertimestamp) AS month,         o.id     FROM ""order"" o     WHERE o.total::numeric > 50 ) AS subquery ON (EXTRACT(MONTH FROM o.ordertimestamp) = month AND o.id = id);"
