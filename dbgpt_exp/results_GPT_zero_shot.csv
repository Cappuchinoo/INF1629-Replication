db,query_id,original_ms,execution_ms_original,planning_ms_original,buffers_plan_original,rewritten_ms,execution_ms_rewritten,planning_ms_rewritten,buffers_plan_rewritten,emissions_original,emissions_rewritten,speedup,buffers_ratio,same_rowcount,same_signature,original_sql,rewritten_sql
webshopdb,1,1783.972,9.338,0.162,10828,1743.110,3.227,0.229,41,2.894,264.098,2.1162981777252213e-05,2.0609872164150788e-05,True,False,"SELECT     c.id AS customer_id,     (SELECT c2.firstname || ' ' || c2.lastname      FROM customer c2      WHERE c2.id = c.id) AS full_name,     (       SELECT SUM(o.total::numeric)       FROM ""order"" o       WHERE o.customer = c.id         AND date_trunc('year', o.ordertimestamp) = (             SELECT date_trunc('year', MIN(ordertimestamp)) FROM ""order""         )     ) AS total_spent_last_year FROM customer c WHERE c.email IS NOT NULL    -- substitui o filtro impossível ORDER BY     (SELECT SUM(o2.total::numeric)      FROM ""order"" o2      WHERE o2.customer = c.id) DESC","SELECT     c.id AS customer_id,     c.firstname || ' ' || c.lastname AS full_name,     SUM(o.total::numeric) FILTER (WHERE date_trunc('year', o.ordertimestamp) = last_year) AS total_spent_last_year FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id CROSS JOIN (SELECT date_trunc('year', MIN(ordertimestamp)) AS last_year FROM ""order"") AS min_year WHERE c.email IS NOT NULL GROUP BY c.id ORDER BY SUM(o.total::numeric) DESC;"
webshopdb,2,2296.771,12.539,0.516,449,2218.691,13.228,0.510,449,0.948,1.000,2.744327086578923e-05,2.6264863777277387e-05,False,False,"SELECT DISTINCT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL       -- substitui o filtro impossível ORDER BY rnd","SELECT     a.id AS article_id,     p.name AS product_name,     a.originalprice,     a.reducedprice,     c.name AS color_name,     random() AS rnd FROM articles a JOIN products p ON p.id = a.productid JOIN colors c ON c.id = a.colorid JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.name IS NOT NULL GROUP BY a.id, p.name, a.originalprice, a.reducedprice, c.name ORDER BY rnd;"
webshopdb,3,1839.886,3.463,0.216,82,1788.136,3.432,0.263,82,1.009,1.000,2.2355662160507485e-05,2.181633569489728e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE c.id IN (     SELECT DISTINCT o.customer     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 )","SELECT     c.id,     c.firstname,     c.lastname,     c.email FROM customer c WHERE EXISTS (     SELECT 1     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id     WHERE op.amount >= 1 AND o.customer = c.id )"
webshopdb,4,1926.166,1.838,0.252,41,1916.085,1.508,0.230,41,1.219,1.000,2.2996178456863115e-05,2.2797741463458247e-05,False,False,"SELECT DISTINCT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC","SELECT     c.id,     c.firstname,     c.lastname,     o.id AS order_id,     o.ordertimestamp FROM customer c LEFT JOIN (     SELECT id, customer, ordertimestamp     FROM ""order""     WHERE ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ) o ON o.customer = c.id ORDER BY o.ordertimestamp DESC"
webshopdb,5,1791.002,5.026,0.243,3676,1742.175,3.314,0.272,56,1.517,65.643,2.125787072700619e-05,2.0737814650974217e-05,True,False,"SELECT     c.id,     c.firstname,     c.lastname,     (         SELECT SUM(o.total::numeric)         FROM ""order"" o         WHERE o.customer = c.id     ) AS total_spent FROM customer c WHERE c.id IN (SELECT customer FROM ""order"") ORDER BY total_spent DESC NULLS LAST","SELECT     c.id,     c.firstname,     c.lastname,     COALESCE(SUM(o.total::numeric), 0) AS total_spent FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE EXISTS (SELECT 1 FROM ""order"" o2 WHERE o2.customer = c.id) GROUP BY c.id ORDER BY total_spent DESC NULLS LAST"
webshopdb,6,1448.053,11.534,0.521,448,1434.987,13.558,0.564,444,0.851,1.009,1.7212540367611172e-05,1.7073905943108672e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"")   AND p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount * op.price::numeric) AS revenue_period FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE p.currentlyactive = TRUE GROUP BY p.id, p.name ORDER BY revenue_period DESC LIMIT 10"
webshopdb,7,1598.891,1.390,0.220,37,1587.980,1.395,0.232,37,0.996,1.000,1.9346888242369916e-05,1.9134532355561225e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 ORDER BY num_orders DESC LIMIT 50","SELECT      c.id,      c.firstname,      c.lastname,      COUNT(o.id) AS num_orders  FROM      customer c  JOIN (     SELECT customer, id      FROM ""order"" ) o ON o.customer = c.id  GROUP BY      c.id, c.firstname, c.lastname  HAVING      COUNT(o.id) >= 5  ORDER BY      num_orders DESC  LIMIT 50"
webshopdb,8,1751.132,1.463,0.247,41,1770.223,1.108,0.203,1687,1.320,0.024,2.0988225019187985e-05,2.1131520338598612e-05,True,True,"SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") ORDER BY o.ordertimestamp DESC LIMIT 500","SELECT     o.id AS order_id,     o.ordertimestamp,     c.id AS customer_id,     c.firstname,     c.lastname,     o.total,     o.shippingcost FROM ""order"" o JOIN customer c ON c.id = o.customer ORDER BY o.ordertimestamp DESC LIMIT 500"
webshopdb,9,1753.031,9.295,0.413,448,1787.182,9.888,0.361,444,0.940,1.009,2.0839387890572135e-05,2.1493345610108118e-05,True,False,"SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MIN(ordertimestamp) FROM ""order"") GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC","SELECT     p.category,     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_qty FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid GROUP BY p.category, p.id, p.name ORDER BY p.category, total_qty DESC"
webshopdb,10,1611.998,1.762,0.224,37,1589.058,1.806,0.209,37,0.976,1.000,1.913338551908909e-05,1.9205212806753088e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200","SELECT     c.id,     c.firstname,     c.lastname,     MAX(o.ordertimestamp) AS last_order_timestamp FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id GROUP BY c.id HAVING MAX(o.ordertimestamp) < current_date - interval '6 months'     OR MAX(o.ordertimestamp) IS NULL ORDER BY last_order_timestamp NULLS FIRST LIMIT 200"
webshopdb,11,1469.540,2.281,0.228,37,1444.847,2.263,0.208,37,1.008,1.000,1.7468306756973734e-05,1.729993894979525e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(o.id) AS num_orders,     SUM(o.total::numeric) AS total_spent,     AVG(o.total::numeric) AS avg_order_value FROM customer c JOIN ""order"" o ON o.customer = c.id GROUP BY c.id HAVING COUNT(o.id) >= 3 ORDER BY avg_order_value DESC LIMIT 20;"
webshopdb,12,1474.465,20.304,0.428,538,1456.994,20.604,0.451,538,0.985,1.000,1.7568782544143904e-05,1.7387243585045754e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM products p JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id LEFT JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name HAVING COALESCE(SUM(s.count), 0) < 10   -- “baixo” estoque ORDER BY total_stock ASC, total_sold DESC;","SELECT      p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock,     COALESCE(SUM(op.amount), 0) AS total_sold FROM      products p LEFT JOIN      articles a ON a.productid = p.id LEFT JOIN      stock s ON s.articleid = a.id LEFT JOIN      order_positions op ON op.articleid = a.id GROUP BY      p.id, p.name HAVING      COALESCE(SUM(s.count), 0) < 10 ORDER BY      total_stock ASC,      total_sold DESC;"
webshopdb,13,1914.602,13.094,0.353,444,1632.915,13.732,0.362,444,0.954,1.000,2.280244749701636e-05,1.9404858975906797e-05,True,True,"SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, revenue DESC;","SELECT     date_trunc('month', o.ordertimestamp) AS month,     p.category,     SUM(op.amount * op.price::numeric) AS revenue FROM ""order"" o JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY month, p.category ORDER BY month, SUM(op.amount * op.price::numeric) DESC;"
webshopdb,14,1786.791,13.219,0.481,462,1781.709,17.672,0.505,462,0.748,1.000,2.11850764114842e-05,2.1265927523382366e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN (     SELECT o.customer, op.articleid     FROM ""order"" o     JOIN order_positions op ON op.orderid = o.id ) AS co ON co.customer = c.id JOIN articles a ON a.id = co.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 3 ORDER BY categories_bought DESC, c.id;"
webshopdb,15,1766.348,12.475,0.768,566,1772.720,11.699,0.609,566,1.066,1.000,2.1044735119537624e-05,2.100706127575063e-05,True,True,"WITH bounds AS (     SELECT (SELECT MAX(ordertimestamp) FROM ""order"") AS max_ts ) SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid CROSS JOIN bounds b WHERE o.ordertimestamp >= b.max_ts - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;","SELECT     a.id AS article_id,     a.description,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS current_stock,     COUNT(DISTINCT o.id) AS num_orders_recent FROM articles a JOIN products p ON p.id = a.productid LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id JOIN ""order"" o ON o.id = op.orderid WHERE o.ordertimestamp >= (SELECT MAX(ordertimestamp) FROM ""order"") - interval '1 year' GROUP BY a.id, a.description, p.name HAVING COALESCE(SUM(s.count), 0) = 0 ORDER BY num_orders_recent DESC;"
webshopdb,16,1584.481,7.105,0.219,425,1636.884,7.186,0.229,425,0.989,1.000,1.8835362260629197e-05,1.948153609324914e-05,True,True,"SELECT     p.id,     p.name FROM products p WHERE p.id NOT IN (     SELECT DISTINCT a.productid     FROM articles a     JOIN order_positions op ON op.articleid = a.id );","SELECT      p.id,      p.name  FROM      products p  LEFT JOIN (     SELECT DISTINCT a.productid      FROM articles a      JOIN order_positions op ON op.articleid = a.id ) subquery ON p.id = subquery.productid  WHERE subquery.productid IS NULL;"
webshopdb,17,1909.891,397.913,0.447,128697,1595.012,9.749,0.307,388,40.816,331.693,2.2688209133785512e-05,1.9024435125091028e-05,True,True,"SELECT     p.id,     p.name,     p.category,     a.reducedprice,     (         SELECT AVG(a2.reducedprice::numeric)         FROM articles a2         JOIN products p2 ON p2.id = a2.productid         WHERE p2.category = p.category     ) AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id WHERE a.reducedprice::numeric > (     SELECT AVG(a3.reducedprice::numeric)     FROM articles a3     JOIN products p3 ON p3.id = a3.productid     WHERE p3.category = p.category ) LIMIT 50;","SELECT     p.id,     p.name,     p.category,     a.reducedprice,     avg_category_price.avg_price AS avg_category_price FROM products p JOIN articles a ON a.productid = p.id JOIN (     SELECT p2.category, AVG(a2.reducedprice::numeric) AS avg_price     FROM products p2     JOIN articles a2 ON a2.productid = p2.id     GROUP BY p2.category ) AS avg_category_price ON avg_category_price.category = p.category WHERE a.reducedprice::numeric > avg_category_price.avg_price LIMIT 50;"
webshopdb,18,1672.178,4.196,0.111,3921,1585.055,1.924,0.136,37,2.181,105.973,1.993187633831193e-05,1.8842964657906107e-05,True,True,"SELECT      c.id,      c.firstname,      c.lastname FROM customer c ORDER BY (     SELECT SUM(o.total::numeric)      FROM ""order"" o      WHERE o.customer = c.id ) DESC  LIMIT 50;","SELECT      c.id,      c.firstname,      c.lastname FROM customer c LEFT JOIN (     SELECT o.customer, SUM(o.total::numeric) AS total_sum     FROM ""order"" o     GROUP BY o.customer ) totals ON totals.customer = c.id ORDER BY total_sum DESC  LIMIT 50;"
webshopdb,19,1750.685,1.831,0.100,2713,1754.116,1.345,0.181,37,1.361,73.324,2.098835230611593e-05,2.0907552634417904e-05,True,False,"SELECT      c.id,     c.firstname,     (SELECT COUNT(*) FROM ""order"" o WHERE o.customer = c.id) AS total_orders FROM customer c WHERE c.id < 1000;","SELECT      c.id,     c.firstname,     COUNT(o.id) AS total_orders FROM customer c LEFT JOIN ""order"" o ON o.customer = c.id WHERE c.id < 1000 GROUP BY c.id;"
webshopdb,20,1607.245,0.887,0.063,19,nan,,,,,,1.9380926443094343e-05,nan,False,False,"SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE EXTRACT(MONTH FROM o.ordertimestamp) = 12   AND o.total::numeric > 50;","SELECT      o.id,     o.ordertimestamp,     o.total FROM ""order"" o WHERE o.ordertimestamp >= '2023-12-01'::date   AND o.ordertimestamp < '2024-01-01'::date   AND o.total > 50;"
webshopdb,21,1785.899,16.021,0.284,493,71981.447,100387.434,0.177,59055236,0.000,0.000,2.125988245845095e-05,0.000858446071007488,True,False,"SELECT     p.id AS product_id,     p.name AS product_name,     COALESCE(SUM(s.count), 0) AS total_stock FROM products p LEFT JOIN articles a ON a.productid = p.id LEFT JOIN stock s ON s.articleid = a.id GROUP BY p.id, p.name ORDER BY total_stock DESC;","SELECT      p.id AS product_id,      p.name AS product_name,      COALESCE(SUM(s.count), 0) AS total_stock  FROM products p  LEFT JOIN (SELECT articleid, SUM(count) AS count FROM stock GROUP BY articleid) s ON s.articleid IN (SELECT id FROM articles WHERE productid = p.id)  GROUP BY p.id, p.name  ORDER BY total_stock DESC;"
webshopdb,22,1445.832,0.029,0.086,1,1471.016,0.029,0.084,1,1.000,1.000,1.714386418979394e-05,1.7437191013440243e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;","SELECT     c.id,     c.firstname,     c.lastname,     c.email,     c.created FROM customer c WHERE c.created >= CURRENT_DATE - INTERVAL '30 days' ORDER BY c.created DESC;"
webshopdb,23,1425.085,9.038,0.341,425,1427.849,8.462,0.338,425,1.068,1.000,1.691918837661742e-05,1.69329858306715e-05,True,True,"SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN articles a ON a.productid = p.id JOIN order_positions op ON op.articleid = a.id GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;","SELECT     p.id AS product_id,     p.name AS product_name,     SUM(op.amount) AS total_sold FROM products p JOIN order_positions op ON op.articleid IN (     SELECT a.id     FROM articles a     WHERE a.productid = p.id ) GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 20;"
webshopdb,24,1416.235,0.066,0.508,4,1425.728,0.070,0.527,4,0.943,1.000,1.6905674719956974e-05,1.6930942146075954e-05,True,True,"SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid WHERE o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;","SELECT     c.id,     c.firstname,     c.lastname,     COUNT(DISTINCT p.category) AS categories_bought FROM customer c JOIN ""order"" o ON o.customer = c.id AND o.ordertimestamp >= CURRENT_DATE - INTERVAL '6 months' JOIN order_positions op ON op.orderid = o.id JOIN articles a ON a.id = op.articleid JOIN products p ON p.id = a.productid GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 4 ORDER BY categories_bought DESC;"
webshopdb,25,1448.895,16.973,0.335,520,1475.441,16.257,0.337,520,1.044,1.000,1.7216280924384533e-05,1.7592477998684596e-05,True,True,"WITH stats AS (     SELECT         a.id AS article_id,         a.description,         SUM(op.amount) AS total_sold,         COALESCE(SUM(s.count), 0) AS current_stock     FROM articles a     LEFT JOIN stock s ON s.articleid = a.id     JOIN order_positions op ON op.articleid = a.id     GROUP BY a.id, a.description ) SELECT     article_id,     description,     total_sold,     current_stock,     (total_sold * 1.0 / NULLIF(current_stock, 0)) AS demand_index FROM stats ORDER BY demand_index DESC NULLS LAST LIMIT 10;","SELECT     a.id AS article_id,     a.description,     SUM(op.amount) AS total_sold,     COALESCE(SUM(s.count), 0) AS current_stock,     (SUM(op.amount) * 1.0 / NULLIF(COALESCE(SUM(s.count), 0), 0)) AS demand_index FROM articles a LEFT JOIN stock s ON s.articleid = a.id JOIN order_positions op ON op.articleid = a.id GROUP BY a.id, a.description ORDER BY demand_index DESC NULLS LAST LIMIT 10;"
